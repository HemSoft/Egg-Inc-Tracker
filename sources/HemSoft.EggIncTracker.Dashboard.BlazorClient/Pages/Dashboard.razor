@page "/"
@page "/dashboard"
@using Microsoft.AspNetCore.Components
@using HemSoft.EggIncTracker.Dashboard.BlazorClient.Components
@implements IDisposable
@implements IAsyncDisposable

<PageTitle>Dashboard</PageTitle>

<div class="dashboard-container mt-4 px-3">
    <div class="d-flex justify-space-between align-center mb-4">
        <MudText Typo="Typo.body2">Last updated: @_timeSinceLastUpdate</MudText>
        <div class="d-flex align-center" style="visibility: @(_isRefreshing ? "visible" : "hidden")">
            <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-2"/>
            <MudText Typo="Typo.body2">Refreshing...</MudText>
        </div>
    </div>

@if (_isRefreshing && _lastUpdated == default)
{
        <!-- Initial loading state - show a loading indicator for the entire dashboard -->
        <div class="d-flex flex-column justify-center align-center" style="height: 400px;">
            <MudProgressCircular Color="Color.Primary" Size="Size.Large" Indeterminate="true" />
            <MudText Typo="Typo.h6" Class="mt-4">Loading dashboard data...</MudText>
            <MudText Typo="Typo.body2" Class="mt-2">This may take a few moments</MudText>
        </div>
}
else
{
        <MudGrid Spacing="2" Class="fill-grid">

            <!----------------->
            <!-- King Monday -->
            <!----------------->
            <MudItem xs="3" Style="cursor: pointer;" @onclick="() => NavigateToPlayerDetail(_kingMondayPlayer.Player?.EID)">
                <PlayerCard Player="_kingMondayPlayer.Player"
                            PlayerStats="_kingMondayPlayer.Stats"
                            PlayerGoals="_kingMondayPlayer.Goals"
                            SEGoalBegin="_kingMondayPlayer.SEGoalBegin"
                            SEGoalEnd="_kingMondayPlayer.SEGoalBegin"
                            EBGoalBegin="_kingMondayPlayer.EBGoalBegin"
                            EBGoalEnd="_kingMondayPlayer.EBGoalEnd"
                            MERGoalBegin="_kingMondayPlayer.MERGoalBegin"
                            MERGoalEnd="_kingMondayPlayer.MERGoalEnd"
                            JERGoalBegin="_kingMondayPlayer.JERGoalBegin"
                            JERGoalEnd="_kingMondayPlayer.JERGoalEnd"
                            DaysToNextTitle="_kingMondayPlayer.DaysToNextTitle"
                            LastUpdatedTimestamp='DashboardState.GetPlayerLastUpdated("King Monday!")' />
            </MudItem>
            <!----------------->
            <!-- King Sunday -->
            <!----------------->
            <MudItem xs="3" Style="cursor: pointer;" @onclick="() => NavigateToPlayerDetail(_kingSundayPlayer.Player?.EID)">
                <PlayerCard Player="_kingSundayPlayer.Player"
                            PlayerStats="_kingSundayPlayer.Stats"
                            PlayerGoals="_kingSundayPlayer.Goals"
                            SEGoalBegin="_kingSundayPlayer.SEGoalBegin"
                            SEGoalEnd="_kingSundayPlayer.SEGoalBegin"
                            EBGoalBegin="_kingSundayPlayer.EBGoalBegin"
                            EBGoalEnd="_kingSundayPlayer.EBGoalEnd"
                            MERGoalBegin="_kingSundayPlayer.MERGoalBegin"
                            MERGoalEnd="_kingSundayPlayer.MERGoalEnd"
                            JERGoalBegin="_kingSundayPlayer.JERGoalBegin"
                            JERGoalEnd="_kingSundayPlayer.JERGoalEnd"
                            DaysToNextTitle="_kingSundayPlayer.DaysToNextTitle"
                            LastUpdatedTimestamp='DashboardState.GetPlayerLastUpdated("King Sunday!")' />
            </MudItem>
            <!------------------->
            <!-- King Saturday -->
            <!------------------->
            <MudItem xs="3" Style="cursor: pointer;" @onclick="() => NavigateToPlayerDetail(_kingSaturdayPlayer.Player?.EID)">
                <PlayerCard Player="_kingSaturdayPlayer.Player"
                            PlayerStats="_kingSaturdayPlayer.Stats"
                            PlayerGoals="_kingSaturdayPlayer.Goals"
                            SEGoalBegin="_kingSaturdayPlayer.SEGoalBegin"
                            SEGoalEnd="_kingSaturdayPlayer.SEGoalBegin"
                            EBGoalBegin="_kingSaturdayPlayer.EBGoalBegin"
                            EBGoalEnd="_kingSaturdayPlayer.EBGoalEnd"
                            MERGoalBegin="_kingSaturdayPlayer.MERGoalBegin"
                            MERGoalEnd="_kingSaturdayPlayer.MERGoalEnd"
                            JERGoalBegin="_kingSaturdayPlayer.JERGoalBegin"
                            JERGoalEnd="_kingSaturdayPlayer.JERGoalEnd"
                            DaysToNextTitle="_kingSaturdayPlayer.DaysToNextTitle"
                            LastUpdatedTimestamp='DashboardState.GetPlayerLastUpdated("King Saturday!")' />
            </MudItem>
            <!----------------->
            <!-- King Friday -->
            <!----------------->
            <MudItem xs="3" Style="cursor: pointer;" @onclick="() => NavigateToPlayerDetail(_kingFridayPlayer.Player?.EID)">
                <PlayerCard Player="_kingFridayPlayer.Player"
                            PlayerStats="_kingFridayPlayer.Stats"
                            PlayerGoals="_kingFridayPlayer.Goals"
                            SEGoalBegin="_kingFridayPlayer.SEGoalBegin"
                            SEGoalEnd="_kingFridayPlayer.SEGoalBegin"
                            EBGoalBegin="_kingFridayPlayer.EBGoalBegin"
                            EBGoalEnd="_kingFridayPlayer.EBGoalEnd"
                            MERGoalBegin="_kingFridayPlayer.MERGoalBegin"
                            MERGoalEnd="_kingFridayPlayer.MERGoalEnd"
                            JERGoalBegin="_kingFridayPlayer.JERGoalBegin"
                            JERGoalEnd="_kingFridayPlayer.JERGoalEnd"
                            DaysToNextTitle="_kingFridayPlayer.DaysToNextTitle"
                            LastUpdatedTimestamp='DashboardState.GetPlayerLastUpdated("King Friday!")' />
            </MudItem>

        </MudGrid>
    }
</div>

@code {
    // Lifecycle methods for component cleanup
    void IDisposable.Dispose()
    {
        // This will call the Dispose method in the code-behind file
    }

    async ValueTask IAsyncDisposable.DisposeAsync()
    {
        // This will call the DisposeAsync method in the code-behind file
        await DisposeAsync();
    }
}
