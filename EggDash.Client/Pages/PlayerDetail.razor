@page "/player/{EID}"
@using Microsoft.AspNetCore.Components

<PageTitle>Player Details - @(_player?.PlayerName ?? "Loading...")</PageTitle>

<div class="dashboard-container mt-4 px-3">
    <MudButton Class="mb-4" Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.ArrowBack" OnClick="NavigateBack">Back to Dashboard</MudButton>
    <MudGrid Spacing="2" Class="fill-grid">
        @if (isLoading)
        {
            <MudItem xs="12">
                <MudPaper Class="pa-4 d-flex justify-center">
                    <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
                </MudPaper>
            </MudItem>
        }
        else if (_player == null)
        {
            <MudItem xs="12">
                <MudAlert Severity="Severity.Error">Player not found</MudAlert>
                <MudText Class="mt-4">Debug Info: EID parameter = '@EID'</MudText>
            </MudItem>
        }
        else
        {
            <!-- Player Information -->
            <MudItem xs="12">
                <MudPaper Class="dashboard-tile d-flex flex-column align-center" Style="height: 100%;">
                    <div class="mb-4 text-center">
                        <MudText Typo="Typo.h4" Align="Align.Center">@_player.PlayerName</MudText>
                        <MudText Typo="Typo.h6" Align="Align.Center">(@_player?.Title)</MudText>
                        <MudText Typo="Typo.body1" Align="Align.Center">
                            <span class="d-inline-flex align-center mr-2">
                                <MudImage src="/assets/egg_of_prophecy.webp" Width="24" Height="24"
                                    Style="vertical-align: middle;"></MudImage>
                                @_player?.ProphecyEggs
                            </span>
                            <span class="d-inline-flex align-center mr-2">
                                <MudImage src="/assets/egg_soul.webp" Width="24" Height="24"
                                    Style="vertical-align: middle;"></MudImage>
                                @_player?.SoulEggs
                            </span>
                        </MudText>
                    </div>

                    <MudText Typo="Typo.subtitle2" Align="Align.Center" Class="mb-2">
                        <span class="d-inline-flex align-center mr-2">
                            SE/Week: (@_playerStats?.SEPerWeek)
                        </span>
                        <span class="d-inline-flex align-center mr-2">
                            SE This Week: @_playerSEThisWeek
                        </span>
                        <span class="d-inline-flex align-center mr-2">
                            Stiges Today/Week: @_player?.PrestigesToday / @_player?.PrestigesThisWeek
                        </span>
                    </MudText>

                    <!-- Title Progress -->
                    <div class="mt-2 px-4" style="width: 100%;">
                        <MudText Typo="Typo.subtitle2" Class="mb-0">
                            Title Progress: @_player?.Title â†’ @_player?.NextTitle
                        </MudText>
                        <MudProgressLinear Color="Color.Info" Value="@(_player?.TitleProgress ?? 0)" Max="100"
                            Striped="false" Size="Size.Large" Style="height: 20px; border-radius: 4px;" Class="my-0">
                            <MudText Typo="Typo.caption" Style="color: white;">
                                @(_player?.TitleProgress.ToString("F1") ?? "0")%
                            </MudText>
                        </MudProgressLinear>
                    </div>

                    <!-- SE Progress Bar: -->
                    <div class="mt-2 px-4" style="width: 100%;">
                        <MudText Typo="Typo.subtitle2" Class="mb-0">
                            SE (@_player?.SoulEggs) -- Rank: @(_SEGoalEnd?.Ranking + 1)
                        </MudText>
                        @{
                            var playerSEGoalPercentage = CalculateProgressPercentage(
                                _player?.SoulEggs, _SEGoalEnd?.SEString, _SEGoalBegin?.SEString);
                        }
                        <MudProgressLinear Color="Color.Success" Value="@playerSEGoalPercentage" Max="100"
                            Striped="false" Size="Size.Large" Style="height: 20px; border-radius: 4px;" Class="my-0">
                            <MudText Typo="Typo.caption" Style="color: white;">
                                @playerSEGoalPercentage.ToString("F1")%
                            </MudText>
                        </MudProgressLinear>
                        <div class="d-flex justify-space-between mt-n1">
                            <MudText Typo="Typo.caption">
                                (@_SEGoalBegin?.SEString) @(_SEGoalBegin?.IGN?.Length > NameCutOff ?
                                    _SEGoalBegin.IGN.Substring(0, NameCutOff) : _SEGoalBegin?.IGN)
                            </MudText>
                            <MudText Typo="Typo.caption">
                                @(_SEGoalEnd?.IGN?.Length > NameCutOff ? _SEGoalEnd.IGN.Substring(0, NameCutOff) :
                                    _SEGoalEnd?.IGN) (@_SEGoalEnd?.SEString)
                            </MudText>
                        </div>
                    </div>

                    <!-- EB Progress Bar: -->
                    <div class="mt-2 px-4" style="width: 100%;">
                        <MudText Typo="Typo.subtitle2" Class="mb-0">
                            EB (@_playerStats?.EB) -- Rank: @(_EBGoalEnd?.Ranking + 1)
                        </MudText>
                        @{
                            var playerEBGoalPercentage = CalculateProgressPercentage(
                                _playerStats?.EB, _EBGoalEnd?.EBString, _EBGoalBegin?.EBString);
                        }
                        <MudProgressLinear Color="Color.Success" Value="@playerEBGoalPercentage" Max="100"
                            Striped="false" Size="Size.Large" Style="height: 20px; border-radius: 4px;" Class="my-0">
                            <MudText Typo="Typo.caption" Style="color: white;">
                                @playerEBGoalPercentage.ToString("F1")%
                            </MudText>
                        </MudProgressLinear>
                        <div class="d-flex justify-space-between mt-n1">
                            <MudText Typo="Typo.caption">
                                (@_EBGoalBegin?.EBString) @(_EBGoalBegin?.IGN?.Length > NameCutOff ?
                                    _EBGoalBegin.IGN.Substring(0, NameCutOff) : _EBGoalBegin?.IGN)
                            </MudText>
                            <MudText Typo="Typo.caption">
                                @(_EBGoalEnd?.IGN?.Length > NameCutOff ? _EBGoalEnd.IGN.Substring(0, NameCutOff) :
                                    _EBGoalEnd?.IGN) (@_EBGoalEnd?.EBString)
                            </MudText>
                        </div>
                    </div>

                    <!-- MER Progress Bar: -->
                    <div class="mt-2 px-4" style="width: 100%;">
                        <MudText Typo="Typo.subtitle2" Class="mb-0">
                            MER (@_playerStats?.MER) -- Rank: @_MERGoalEnd?.Ranking
                        </MudText>
                        @{
                            var playerMERGoalPercentage = CalculateProgressPercentage(_playerStats?.MER.ToString(),
                                _MERGoalEnd?.MER.ToString(), _MERGoalBegin?.MER.ToString());
                        }
                        <MudProgressLinear Color="Color.Success" Value="@playerMERGoalPercentage" Max="100"
                            Striped="false" Size="Size.Large" Style="height: 20px; border-radius: 4px;" Class="my-0">
                            <MudText Typo="Typo.caption" Style="color: white;">
                                @playerMERGoalPercentage.ToString("F1")%
                            </MudText>
                        </MudProgressLinear>
                        <div class="d-flex justify-space-between mt-n1">
                            <MudText Typo="Typo.caption">
                                (@_MERGoalBegin?.MER) @(_MERGoalBegin?.IGN?.Length > NameCutOff ?
                                    _MERGoalBegin.IGN.Substring(0, NameCutOff) : _MERGoalBegin?.IGN)
                            </MudText>
                            <MudText Typo="Typo.caption">
                                @(_MERGoalEnd?.IGN?.Length > NameCutOff ? _MERGoalEnd.IGN.Substring(0, NameCutOff) :
                                    _MERGoalEnd?.IGN) (@_MERGoalEnd?.MER)
                            </MudText>
                        </div>
                    </div>

                    <!-- JER Progress Bar: -->
                    <div class="mt-2 px-4" style="width: 100%;">
                        <MudText Typo="Typo.subtitle2" Class="mb-0">
                            JER (@_playerStats?.JER) -- Rank: @_JERGoalEnd?.Ranking
                        </MudText>
                        @{
                            var playerJERGoalPercentage = CalculateProgressPercentage(_playerStats?.JER.ToString(),
                                _JERGoalEnd?.JER.ToString(), _JERGoalBegin?.JER.ToString());
                        }
                        <MudProgressLinear Color="Color.Success" Value="@playerJERGoalPercentage" Max="100"
                            Striped="false" Size="Size.Large" Style="height: 20px; border-radius: 4px;" Class="my-0">
                            <MudText Typo="Typo.caption" Style="color: white;">
                                @playerJERGoalPercentage.ToString("F1")%
                            </MudText>
                        </MudProgressLinear>
                        <div class="d-flex justify-space-between mt-n1">
                            <MudText Typo="Typo.caption">
                                (@_JERGoalBegin?.JER) @(_JERGoalBegin?.IGN?.Length > NameCutOff ?
                                    _JERGoalBegin.IGN.Substring(0, NameCutOff) : _JERGoalBegin?.IGN)
                            </MudText>
                            <MudText Typo="Typo.caption">
                                @(_JERGoalEnd?.IGN?.Length > NameCutOff ? _JERGoalEnd.IGN.Substring(0, NameCutOff) :
                                    _JERGoalEnd?.IGN) (@_JERGoalEnd?.JER)
                            </MudText>
                        </div>
                    </div>
                </MudPaper>
            </MudItem>

            <!-- Placeholder for future content -->
            <MudItem xs="6">
                <MudPaper Class="dashboard-tile d-flex flex-column align-center" Style="height: 100%;">
                    <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="100%" Width="100%" />
                </MudPaper>
            </MudItem>

            <MudItem xs="6">
                <MudPaper Class="dashboard-tile d-flex flex-column align-center" Style="height: 100%;">
                    <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="100%" Width="100%" />
                </MudPaper>
            </MudItem>

            <MudItem xs="12">
                <MudPaper Class="dashboard-tile d-flex flex-column align-center" Style="height: 100%;">
                    <MudSkeleton SkeletonType="SkeletonType.Rectangle" Height="100%" Width="100%" />
                </MudPaper>
            </MudItem>
        }
    </MudGrid>
</div>
